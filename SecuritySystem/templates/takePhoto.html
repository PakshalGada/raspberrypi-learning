<!DOCTYPE html>
<html>
<head>
    <title>AI Camera</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='takePhoto.css') }}">
</head>
<body>
    <div class='nav'>
        <h1>AI Camera</h1>
        <div class='dashAcc'>
			<a class='dashboardButton' href="{{ url_for('aiCamera') }}">Back</a>
            <a class='dashboardButton' href="{{ url_for('dashboard') }}">Dashboard</a>
            <a class='dashboardButton' href="{{ url_for('logout') }}">Logout</a>
        </div>
    </div>
    
    <div id="nameSection" class="section">
        <h2>Enter Your Name</h2>
        <div class="input-container">
            <input type="text" id="userName" placeholder="Enter your name" class="name-input">
            <button onclick="startCamera()" class="cameraButton">Start Camera</button>
        </div>
    </div>

    <div id="cameraSection" class="section" style="display: none;">
        <h2 id="userGreeting"></h2>
        <div class="camera-container">
            <img id="video_feed" src="{{ url_for('video_feed') }}" alt="Live Camera Feed" class="camera-feed">
        </div>
        <div class="button-row">
            <button onclick="capturePhoto()" class="cameraButton">Take Photo</button>
            <button onclick="resetCamera()" class="cameraButton">Change Name</button>
        </div>
        <div id="message" class="message"></div>
    </div>

    <script>
        let currentUserName = '';

        function startCamera() {
            const userName = document.getElementById('userName').value.trim();
            if (userName === '') {
                alert('Please enter your name first!');
                return;
            }
            
            currentUserName = userName;
            document.getElementById('nameSection').style.display = 'none';
            document.getElementById('cameraSection').style.display = 'block';
            document.getElementById('userGreeting').textContent = `Welcome, ${userName}! Take your photos below.`;
        }

        function capturePhoto() {
            if (!currentUserName) {
                alert('No user name set!');
                return;
            }

            fetch(`/capture_named?name=${encodeURIComponent(currentUserName)}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('message').innerHTML = `<div class="success">${data.message}</div>`;
                    setTimeout(() => {
                        document.getElementById('message').innerHTML = '';
                    }, 3000);
                })
                .catch(error => {
                    document.getElementById('message').innerHTML = `<div class="error">Error: ${error}</div>`;
                });
        }

        function resetCamera() {
            currentUserName = '';
            document.getElementById('userName').value = '';
            document.getElementById('nameSection').style.display = 'block';
            document.getElementById('cameraSection').style.display = 'none';
            document.getElementById('message').innerHTML = '';
        }
    </script>
</body>
</html>
